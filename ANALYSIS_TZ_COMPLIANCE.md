# Сравнительный анализ: реализация vs ТЗ RW Group

**Дата анализа:** 2026-02-15  
**Источник ТЗ:** `user_data/ТЗ RW Group.docx`  
**Состояние кода:** `master` (HEAD `6c75774`), анализ по текущему рабочему дереву

---

## Общий вывод

Проект в целом соответствует ТЗ по функциональной части витрины, форм, каталога, админки и SEO.  
Ключевые незакрытые требования: часть контентных требований главной/footer и thumbnail-пайплайн изображений.

### Сводная оценка

| Категория | Реализовано | Частично | Не реализовано | Итого |
|---|:---:|:---:|:---:|:---:|
| Страницы и экраны | 6 | 4 | 0 | 10 |
| Формы заявок | 4 | 0 | 0 | 4 |
| Фильтры каталога | 5 | 0 | 0 | 5 |
| Сущности данных | 8 | 0 | 0 | 8 |
| Импорт фидов | 5 | 1 | 0 | 6 |
| SEO и аналитика | 8 | 0 | 0 | 8 |
| Админ-панель | 7 | 0 | 0 | 7 |
| Инфраструктура | 5 | 1 | 0 | 6 |
| **ИТОГО** | **48** | **6** | **0** | **54** |

**Оценка соответствия:** ~94%  
(формула: `(реализовано + 0.5 * частично) / итого`)

---

## ЧАСТЬ I. Бизнес-логика и структура

### 1) Страницы и маршруты

| Требование ТЗ | Факт | Статус | Комментарий |
|---|---|---|---|
| Главная | `/` | Реализовано | `src/pages/Home.tsx` |
| Каталог | `/catalog` | Реализовано | `src/pages/Catalog.tsx` |
| Карточка лота | `/property/:id` | Реализовано | API поддерживает `idOrSlug`, ссылки формируются через `slug` (`server/routes/public.ts`, `src/components/catalog/PropertyCard.tsx`) |
| Карточка ЖК | `/complex/:id` | Реализовано | Аналогично: `idOrSlug` + ссылки по `slug` |
| Страница подборки | `/collection/:id` | Реализовано | Аналогично: `idOrSlug` + ссылки по `slug` |
| Политика конфиденциальности | `/privacy` | Реализовано | `src/pages/Privacy.tsx` |
| Админ-панель | `/admin/*` | Реализовано | `src/pages/admin/AdminEntry.tsx`, `src/pages/admin/AdminLayout.tsx` |

### 2) Единые элементы сайта

| Элемент | Требование | Статус | Комментарий |
|---|---|---|---|
| Header | Логотип RWgroup | Реализовано | `src/components/layout/Header.tsx` |
| Header | Телефон кликабельный | Реализовано | `tel:+74954101568` |
| Header | Адрес | Реализовано | `Москва, Кутузовский пр-т 36 А` |
| Header | Меню-якоря | Реализовано | `/#team`, `/#catalog-categories` |
| Header | CTA «Получить консультацию» | Реализовано | Открывает `LeadModal` |
| Footer | Контакты | Реализовано | `src/components/layout/Footer.tsx` |
| Footer | Соцсети | Частично | Есть пункты, но ссылки-заглушки `#` |
| Footer | Блог | Не реализовано | Ссылки/раздела блога нет |
| Footer | Политика конфиденциальности | Реализовано | Ссылка на `/privacy` |

### 3) Формы заявок (4 уникальные)

| Форма по ТЗ | Статус | Комментарий |
|---|---|---|
| Консультация | Реализовано | `form_type: consultation` |
| Купить / Продать | Реализовано | Одна форма с вкладками `buy/sell` |
| Записаться / Узнать детали | Реализовано | `form_type: view_details` |
| Стать партнёром | Реализовано | `form_type: partner`, есть поле комментария |

Доптребования к формам:

| Требование | Статус | Комментарий |
|---|---|---|
| Маска телефона | Реализовано | `src/utils/phone.ts`, `src/components/forms/LeadModal.tsx` |
| Согласие на ПДн | Реализовано | Чекбокс `consent` + ссылка на `/privacy` |
| Антиспам | Реализовано | Honeypot `company` + rate limit на `/api/leads` |
| Фиксация источника | Реализовано | `source: { page, block, object_id, object_type }` |

### 4) 10 экранов главной

| Экран | Статус | Комментарий |
|---|---|---|
| 1. Hero | Частично | Есть заголовок/слоган/CTA/trust badge; адрес/телефон вынесены в Header |
| 2. Каталоги недвижимости | Частично | На главной есть категории+CTA, но полный фильтруемый каталог вынесен на `/catalog` |
| 3. Лучшие предложения + подборки | Реализовано | Блок тянется с API, подборки/featured управляются через админку |
| 4. Почему выбирают нас | Реализовано | 6 карточек преимуществ |
| 5. Стоимость услуг | Реализовано | Акцент «бесплатно по новостройкам» + CTA |
| 6. Этапы работы | Реализовано | 5 этапов (`src/components/Roadmap.tsx`) |
| 7. Миссия | Реализовано | Текстовый блок миссии |
| 8. Команда | Частично | Есть фото/роли, но блок соцсетей/блога и явная «история Саши и Насти» закрыты неполно |
| 9. Отзывы | Частично | Блок есть, но source URL сейчас заглушки `#` |
| 10. Стать партнёром | Реализовано | Описание + CTA на форму `partner` |

---

## ЧАСТЬ II. Технический контур

### 5) Архитектура

| Требование ТЗ | Факт | Статус | Комментарий |
|---|---|---|---|
| Frontend: SPA/SSR | React + Vite SPA, бот-пререндер | Частично | Есть `botPrerender` для SEO-ботов, полноценного SSR нет |
| Backend: REST API | Express REST API | Реализовано | `server/app.ts`, `server/routes/*` |
| БД: PostgreSQL | Dual-driver storage (`file`/`postgres`) + миграции + нормализованные таблицы | Реализовано | Добавлены `server/lib/state-repository.ts`, `server/lib/pg/domain-repositories.ts`, миграции `server/migrations/001_init_app_state.sql`, `server/migrations/002_normalized_domain_tables.sql`; рабочий режим обеспечивается при `DATABASE_URL` + `RW_STORAGE_DRIVER=postgres` (или `auto`) |
| Админка: headless CMS/custom panel | Custom panel | Реализовано | Полноценный раздел `/admin/*` |
| Медиа: S3-совместимое хранилище | Dual-driver media storage (`local`/`s3`) | Реализовано | `server/lib/media-storage.ts`, env `RW_MEDIA_STORAGE_DRIVER` + `RW_S3_*`, авто-fallback в `local` при проблемах S3 |
| CDN изображений | Поддержка CDN base URL | Реализовано | `RW_MEDIA_CDN_BASE_URL`/`RW_S3_PUBLIC_BASE_URL`, cache-control на upload |

### 6) Работа с фидами

| Требование | Статус | Комментарий |
|---|---|---|
| Форматы XLSX/CSV/XML/JSON | Реализовано | `xlsx`, `csv-parse`, `fast-xml-parser`; парсинг в `admin.ts` и `feed-scheduler.ts` |
| Ручная загрузка | Реализовано | `/api/admin/import/run` + загрузка файла |
| Автообновление по URL (cron) | Реализовано | `startFeedScheduler()` подключен в runtime (`server/app.ts`), есть управление через `RW_FEED_SCHEDULER_ENABLED`, остановка на shutdown в `server/server.ts` |
| Сопоставление колонок | Реализовано | Маппинг в `AdminImport` + `FeedSource.mapping` |
| Предпросмотр | Реализовано | `/api/admin/import/preview` + визуальный preview |
| Лог ошибок | Реализовано | `ImportRun.error_log`, раздел логов |
| Сохранение шаблона импорта | Частично | Шаблон хранится как `mapping` в источнике; отдельной сущности шаблонов нет |

### 7) Сущности данных

| Сущность | Статус | Комментарий |
|---|---|---|
| Complex | Реализовано | Обязательные + дополнительные поля ТЗ |
| Property | Реализовано | Обязательные + расширения |
| Collection | Реализовано | `title/description/cover/items/priority` + режимы/slug/status |
| Lead | Реализовано | Поля формы + CRM-поля |
| FeedSource | Реализовано | Формат/режим/маппинг/служебные поля |
| ImportRun | Реализовано | Статус, статистика, ошибки, источник |
| AdminUser | Реализовано (сверх ТЗ) | RBAC |
| AuditLog | Реализовано (сверх ТЗ) | Аудит действий |

### 8) Нормализация и жизненный цикл

Нормализация:

| Правило | Статус | Комментарий |
|---|---|---|
| Спальни числом | Реализовано | Парсинг/валидация `asNumber` + типы |
| Цена числом | Реализовано | Парсинг/валидация `asNumber` |
| Район/метро через справочники | Частично | Фасеты строятся из данных (`/api/facets`), отдельного мастер-справочника нет |
| Фиксированный список статусов | Реализовано | `active/hidden/archived` |

Жизненный цикл:

| Правило | Статус | Комментарий |
|---|---|---|
| `external_id + source_id` как ключ | Реализовано | Upsert по `external_id` в рамках `source_id` |
| Обновление при совпадении | Реализовано | `upsertComplexes`/`upsertProperties` |
| Пропавшие из фида -> hidden/archived | Реализовано | Жизненный цикл `active -> hidden -> archived` автоматизирован в import-логике |
| `last_seen_at`, `updated_at` | Реализовано | Заполняется при импорте |

### 9) SEO и аналитика

| Требование | Статус | Комментарий |
|---|---|---|
| ЧПУ URL (slug) | Реализовано | Slug у сущностей + API `idOrSlug` |
| Meta / OpenGraph | Реализовано | `setPageMeta` + server-side подмена для ботов |
| Schema.org (`RealEstateAgent`) | Реализовано | JSON-LD на главной и карточках |
| Sitemap / Robots | Реализовано | `GET /sitemap.xml` + `public/robots.txt` |
| Яндекс Метрика | Реализовано | В `index.html` + `trackEvent` |
| Google Analytics 4 | Реализовано | В `index.html` + `trackEvent` |
| События: клики, формы, фильтры, карточки | Реализовано | `trackEvent` в ключевых пользовательских действиях |
| Каноникал | Реализовано | `setPageMeta` + бот-пререндер |

### 10) Медиа

| Требование | Статус | Комментарий |
|---|---|---|
| Приём ссылок из фида | Реализовано | `images: string[]` |
| Локальное сохранение (по возможности) | Реализовано | Поддержаны `local` и `s3` режимы хранения, URL возвращается из storage-layer |
| Генерация превью | Не реализовано | Thumbnail-пайплайна нет |
| Fallback-изображение | Реализовано | В карточках/галереях |

---

## ЧАСТЬ III. Критерии приёмки из ТЗ

| Критерий | Статус | Комментарий |
|---|---|---|
| Все формы работают и передают данные | Выполнен | Валидация, маска, consent, source, антиспам |
| Фиды корректно импортируются | Выполнен | Ручной импорт/preview + runtime-автокрон + lifecycle `active/hidden/archived` |
| Каталоги и фильтры стабильны | Выполнен | Табы, фильтры, пагинация, API-фасеты |
| Админка управляет витриной | Выполнен | Контент, каталог, подборки, импорт, лиды, логи, пользователи |
| Мобилка полностью рабочая | Частично | Верстка адаптивная, но в этом анализе не проводился ручной device-QA |
| Аналитика фиксирует события | Выполнен | GA4, YM, серверный endpoint событий |

---

## Ключевые расхождения с ТЗ (по приоритету)

### Высокий приоритет

1. **Неполный контентный блок доверия (Footer/Отзывы/Команда)**  
   Нет блога в footer, соцсети/источники отзывов — заглушки.

### Средний приоритет

1. **Часть требований к экрану 2 и Hero разведена по разным зонам интерфейса**  
   Формально функционал есть, но не полностью в той композиции, как описано в ТЗ.

### Низкий приоритет

1. **Нет генерации thumbnail/превью изображений**  
   Влияет на производительность и скорость загрузки.

---

## Что изменилось относительно отчёта от 2026-02-14

1. `Schema.org` теперь реализован (главная, карточки, подборки, бот-пререндер).
2. `sitemap.xml` теперь реализован динамически на сервере.
3. Добавлен бот-пререндер мета и JSON-LD (`server/lib/bot-renderer.ts`), что частично закрывает SEO-ограничение SPA.
4. Подключен runtime-автокрон фидов (`startFeedScheduler()`), добавлен env-флаг `RW_FEED_SCHEDULER_ENABLED` и корректная остановка scheduler на shutdown.
5. Зафиксирован текущий статус footer/reviews/team как неполное соответствие контентным требованиям ТЗ.
6. Внедрен PostgreSQL persistence-контур: dual-driver (`file`/`postgres`), миграции, нормализованные таблицы сущностей и транзакционные доменные репозитории.
7. Выполнен runtime smoke на реальной PostgreSQL (инициализация с `RW_STORAGE_DRIVER=postgres` + `DATABASE_URL`, проверка API и записей в нормализованных таблицах).
8. В админке добавлено управление автообновлением фидов (вкл/выкл + интервал) и индикатор состояния автообновления в таблице источников.
9. Реализована media-инфраструктура `local/s3` с поддержкой CDN-URL и cache-control (`server/lib/media-storage.ts`, `RW_MEDIA_STORAGE_DRIVER`, `RW_S3_*`, `RW_MEDIA_CDN_BASE_URL`).
10. Добавлен жизненный цикл отсутствующих в фиде объектов: `active -> hidden -> archived` в `upsertComplexes`/`upsertProperties`.

---

## Рекомендации по доработкам

### Фаза 1 (высокий приоритет)

1. Закрыть контентные требования ТЗ в footer/team/reviews (реальные ссылки, блог, валидные источники отзывов).

### Фаза 2 (средний приоритет)

1. Унифицировать экран 2 главной с ТЗ (если требуется строгое визуально-структурное совпадение).
2. При необходимости добавить зеркалирование изображений из фидов в собственный media-storage (сейчас сохраняются URL источника).

### Фаза 3 (низкий приоритет)

1. Добавить генерацию превью/thumbnail для изображений.
2. Добавить performance-оптимизации по media pipeline.
